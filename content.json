{"meta":{"title":"蜗牛壳","subtitle":null,"description":null,"author":"ChenHuang","url":"http://yoursite.com"},"pages":[{"title":"李辛格传","date":"2018-07-08T03:38:08.000Z","updated":"2019-03-07T09:04:13.113Z","comments":true,"path":"about/index.html","permalink":"http://yoursite.com/about/index.html","excerpt":"","text":"简介黄晨，号李辛格。尘世中一个迷途小码农。 工作&amp;实习经历 时间 公司 岗位 2018.03 ~ 至今 携程旅行网机票BU 测试开发工程师&amp;java开发工程师 2016.06 ~ 2017.02 英特尔亚太研发有限公司 自动化测试工程师 教育经历 时间 学校 专业 学历 2015.09 ~ 2018.03 华东师范大学 电子与通信工程 硕士 2011.09 ~ 2015.06 南昌大学 应用物理学 本科"},{"title":"标签","date":"2018-07-08T03:38:08.000Z","updated":"2019-03-06T11:40:58.574Z","comments":true,"path":"tags/index.html","permalink":"http://yoursite.com/tags/index.html","excerpt":"","text":""}],"posts":[{"title":"jmockito","slug":"jmockito","date":"2019-03-07T11:01:00.000Z","updated":"2019-03-07T12:03:31.403Z","comments":true,"path":"2019/03/07/jmockito/","link":"","permalink":"http://yoursite.com/2019/03/07/jmockito/","excerpt":"","text":"前言最近换到了新组，增值-交叉BU，主要的业务就是机票完成页上售卖一些X产品，我是写服务端的，然后jenkins上单元测试覆盖率有点低，目前branch的覆盖率在百分之十四，而目标是在四月一号前达到百分之五十。所以最近接触的单测工具有点多，用过的几款有：powermock、mockito、jmockito。而powermock跟jenkins上的jacoco不兼容，mockito无法mock私有方法，jmokito成功提升了单测覆盖率。在这里总结一下jmockito的使用方法。 简介jmockito网站jmokito可以用来mock静态方法，类内部的私有方法、私有变量以及引用的其他类的方法。这里就不讲怎么引用maven包，直接上手用了。 几个概念CUT(code under test)被测试代码 mock和stubmock是基于“行为”的测试，主要测试cut和被依赖着之间的相互调用；stub是基于“状态”的测试，主要测试CUT和被依赖者内部数据的状态。JMockit有两套API，mock API用来进行mock测试；mock-up API用来进行stub测试。 API用法@Mocked加上了JMockit的API @Mocked, JMockit会实例化这个对象Mocked可以用来修饰类、接口和抽象类，返回默认值（如果是原始类型，返回原始值的默认值，如果为其他对象，则返回一个同样被Mocked的对象）Mocked十分粗暴，会mock掉整个的实现 @Injectable@Injectable功能跟@Mocked相似，区别是@Injectable只针对修饰的实例，对mock类的静态方法、构造函数没有影响 @Tested@Tested表示被测试对象。如果该对象没有赋值，JMockit会去实例化它，若@Tested的构造函数有参数，则JMockit通过在测试属性&amp;测试参数中查找@Injectable修饰的Mocked对象注入@Tested对象的构造函数来实例化，不然，则用无参构造函数来实例化。除了构造函数的注入，JMockit还会通过属性查找的方式，把@Injectable对象注入到@Tested对象中。注入的匹配规则：先类型，再名称(构造函数参数名，类的属性名)。若找到多个可以注入的@Injectable，则选择最优先定义的@Injectable对象 @Capturing@Capturing主要用于子类/实现类的Mock，比如java动态代理生成的类，这些类没有名字，无法进行正常的mock当只知道父类或接口时，但需要控制其子类的行为时，子类可能有多个实现（可能有人工写的，也可能是AOP代理自动生成时），需要使用@Capturing ExpectationsRecord对象的核心方法，最核心和重要的注解了，可以和引用外部类的Mock对象(@Injectabe,@Mocked,@Capturing)来录制，也可以通过构建函数注入类/对象来录制限制：不能mock对象的native方法和private方法 MockUp &amp; MockMockUp &amp; @Mock提供更改代码行为的Mock方式，最强大mock实现，主要有以下限制： 无法mock单个实例 无法mock动态代理对象 对类的所有方法都进行Mock，书写MockUp的代码量太大，可以用于项目中比较通用模块，减少大量重复的Exceptations VerificationsVerifications是用于做验证，过程式编程的福音，验证Mock对象（即@Moked/@Injectable@Capturing修饰的或传入Expectation构造函数的对象)有没有调用过某方法，调用了多少次主要用于一些没有返回值的代码验证 使用流程recoed(录制)--&gt;replay(回放)--&gt;verify(验证) 假设下面这个类是要测试的1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283package com.ctrip.flight.mobile.fio.core.xrecommend.card;import com.alibaba.fastjson.JSON;import com.ctrip.flight.mobile.fio.common.qconfig.factory.QConfigManager;import com.ctrip.flight.mobile.fio.core.xrecommend.constant.CardExtraType;import com.ctrip.flight.mobile.fio.core.xrecommend.context.AdContext;import com.ctrip.flight.mobile.fio.core.xrecommend.service.adbannerservice.AdBannerModelTransfer;import com.ctrip.flight.mobile.fio.core.xrecommend.service.adbannerservice.customize.CustomizeAdBannerService;import com.ctrip.flight.mobile.fio.model.pojo.adbanner.FlightCompleteAdBannerConfigPojo;import com.ctrip.flight.mobile.fio.model.pojo.adbanner.FlightCompleteBannerImgItemDTO;import com.ctrip.flight.mobile.fio.model.pojo.visitorinfo.VisitorInfo;import com.ctrip.model.flight.wireless.fio.ad.v1.entity.FlightMarketCardInformationType;import com.ctrip.model.flight.wireless.fio.ad.v1.entity.FlightXProductExtendInformationType;import com.ctriposs.baiji.rpc.mobile.common.types.MobileRequestHead;import org.springframework.beans.factory.annotation.Autowired;import org.springframework.stereotype.Service;import java.util.ArrayList;import java.util.List;@Service(\"AdBannerRecommend\")public class AdBannerRecommend extends AbstractRecommend &#123; private AdBannerModelTransfer adBannerModelTransfer; private CustomizeAdBannerService customizeAdBannerService; private QConfigManager qConfigManager; @Autowired public AdBannerRecommend(AdBannerModelTransfer adBannerModelTransfer, CustomizeAdBannerService customizeAdBannerService) &#123; this.adBannerModelTransfer = adBannerModelTransfer; this.customizeAdBannerService = customizeAdBannerService; &#125; @Override public List&lt;FlightMarketCardInformationType&gt; getMarketCards(VisitorInfo visitor, MobileRequestHead head, AdContext adContext) &#123; qConfigManager = adContext.getqConfigManager(); return getResult(adContext); &#125; public List&lt;FlightMarketCardInformationType&gt; getResult(AdContext adContext) &#123; // 获得广告横幅卡片，productType=15 List&lt;FlightMarketCardInformationType&gt; cards = new ArrayList&lt;&gt;(); FlightMarketCardInformationType card = qConfigManager.getAdBannerCard(); // 设置广告横幅的扩展信息，EXTRA_TYPE=18 List&lt;FlightXProductExtendInformationType&gt; extas = new ArrayList&lt;&gt;(); FlightXProductExtendInformationType exta = new FlightXProductExtendInformationType(); exta.setExtentType(CardExtraType.EXTRA_TYPE_18); exta.setContent(buildCard(adContext)); extas.add(exta); if (card != null) &#123; card.setExtendInfo(extas); cards.add(card); &#125; return cards; &#125; private String buildCard(AdContext adContext) &#123; // 从qconfig获得广告位配置，[] List&lt;FlightCompleteAdBannerConfigPojo&gt; banners = qConfigManager.getAdBanners(); List&lt;FlightCompleteBannerImgItemDTO&gt; bs = adBannerModelTransfer.transfer(banners); // 添加所有的自定义广告banner bs.addAll(buildCustomizeAdBanners(adContext.getVisitorInfo(), adContext)); return JSON.toJSONString(bs); &#125; /** * 大配置版本的广告banner * * @param visitor * @param adContext * @return */ private List&lt;FlightCompleteBannerImgItemDTO&gt; buildCustomizeAdBanners(VisitorInfo visitor, AdContext adContext) &#123; return customizeAdBannerService.transfer(visitor, adContext); &#125;&#125; 12345678910111213141516@Test public void getMarketCardsTest(final @Mocked VisitorInfo visitorInfo, final @Mocked MobileRequestHead head, final @Mocked AdContext adContext) throws Exception &#123; //录制方法的预期行为， new MockUp&lt;AdBannerRecommend&gt;() &#123; @Mock public List&lt;FlightMarketCardInformationType&gt; getResult(AdContext adContext) &#123; return new ArrayList&lt;&gt;(); &#125; &#125;; //这里要两个大括号 new Expectations() &#123;&#123; adContext.getqConfigManager(); result = null; &#125;&#125;; Assert.assertNotNull(adBannerRecommend.getMarketCards(visitorInfo, head, adContext)); &#125;","categories":[],"tags":[{"name":"java","slug":"java","permalink":"http://yoursite.com/tags/java/"},{"name":"单元测试工具","slug":"单元测试工具","permalink":"http://yoursite.com/tags/单元测试工具/"}]},{"title":"夏天来了","slug":"夏天来了","date":"2018-07-08T09:42:45.000Z","updated":"2019-03-07T04:18:04.936Z","comments":true,"path":"2018/07/08/夏天来了/","link":"","permalink":"http://yoursite.com/2018/07/08/夏天来了/","excerpt":"这篇文章加密了","text":"Welcome to my blog, enter password to read. Incorrect Password! No content to display! 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","categories":[],"tags":[{"name":"生活","slug":"生活","permalink":"http://yoursite.com/tags/生活/"},{"name":"随笔","slug":"随笔","permalink":"http://yoursite.com/tags/随笔/"}]},{"title":"Hello World","slug":"hello-world","date":"2018-07-08T04:42:45.000Z","updated":"2019-03-07T02:50:10.230Z","comments":true,"path":"2018/07/08/hello-world/","link":"","permalink":"http://yoursite.com/2018/07/08/hello-world/","excerpt":"","text":"Welcome to Hexo! This is your very first post. Check documentation for more info. If you get any problems when using Hexo, you can find the answer in troubleshooting or you can ask me on GitHub. Quick StartCreate a new post1$ hexo new \"My New Post\" More info: Writing Run server1$ hexo server More info: Server Generate static files1$ hexo generate More info: Generating Deploy to remote sites1$ hexo deploy More info: Deployment","categories":[],"tags":[]}]}